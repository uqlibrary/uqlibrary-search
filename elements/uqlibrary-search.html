<link rel="import" href="elements.html">

<!--
`<uqlibrary-search>` is a simple element that displays search functionality of UQ Library

Example:

  <uqlibrary-search></uqlibrary-search>

@demo

@demo demo/index.html Demo of uqlibrary-search
-->
<dom-module id="uqlibrary-search">
  <template>
    <style is="custom-style" include="common-styles">
    :host {
      font-family: var(--font-family);
      font-size: var(--body-font-size);

      @apply(--layout-horizontal);
      @apply(--layout-wrap);
    }

    #menuSources,
    #buttonSearch {
      @apply(--layout-flex-1);
    }

    #menuSources,
    #inputSources,
    #searchKeywordInput {
      margin-right: 8px;
      padding-left: 8px;
      padding-right: 4px;
      background-color: var(--secondary-color-light);
      border-radius: 3px;
      min-width: 210px;
    }

    #menuSources2 {
      border-radius: 3px;
      @apply(--shadow-elevation-2dp);
    }

    #searchKeywordInput {
      @apply(--layout-flex);
    }

    #buttonSearch iron-icon {
      margin-top: 9px;
    }

    @media screen and (max-width: 320px) {
      #menuSources {
        min-width: calc(100%);
      }
    }

    @media screen and (max-width: 815px) {
      :host {
        @apply(--layout-flex-none);
      }

      #menuSources {
        width: 100%;
        display: block;
        margin-bottom: 8px;
        margin-right: 0;
        min-width: 300px;
      }

      #searchKeywordInput {
        min-width: calc(100% - 105px);
      }
    }

  </style>

    <uqlibrary-ga id="ga" app-name="{{gaAppName}}"></uqlibrary-ga>

    <byutv-jsonp
            id="jsonpQuery"
            callback-value="foo"
            on-response="_suggestionsLoaded"
            on-error="_suggestionsLoadingError"
            disable-uri-encoding="true"
            debounce-duration="300"></byutv-jsonp>

    <iron-localstorage id="localstorage"
                       name="uqlibrary-search-storage"
                       value="{{recent}}"
                       on-iron-localstorage-load="_localStorageLoaded"
                       on-iron-localstorage-load-empty="_localStorageLoaded"></iron-localstorage>



    <paper-input label="Search" id="inputSources" on-tap="_keywordFocused" value="{{selectedSource.name}}">
    </paper-input>

    <uqlibrary-iron-dropdown id="menuSources2" no-auto-focus="true"
                             horizontal-align="left" vertical-align="top" position-absolute="true"
                             horizontal-offset="25" vertical-offset="70" tabindex="-1">

      <paper-listbox id="listSources" class="dropdown-content" selected="{{selectedSourceIndex}}">
        <template is="dom-repeat" items="[[sources]]">
          <paper-item>
            <iron-icon icon="[[item.icon]]"></iron-icon> [[item.name]]
          </paper-item>
        </template>
      </paper-listbox>

    </uqlibrary-iron-dropdown>

    <uqlibrary-autosuggest-input id="searchKeywordInput" label="[[selectedSource.inputPlaceholder]]" source="{{selectedSource}}"
                                 on-activated="_searchActivated" on-keyword-changed="_keywordChanged" on-focus="_closeSources"></uqlibrary-autosuggest-input>

    <paper-button id="buttonSearch" on-tap="_searchActivated" class="button-colored-accent">
      <iron-icon icon="icons:search" aria-label="Search [[selectedSource.title]]"></iron-icon>
    </paper-button>


    <paper-dropdown-menu id="menuSources" label="Search" allow-outside-scroll="true" noink no-animations style="display: none;">
      <paper-listbox class="dropdown-content" selected="{{selectedSourceIndex}}">
        <template is="dom-repeat" items="[[sources]]">
          <paper-item>
            <iron-icon icon="[[item.icon]]"></iron-icon> [[item.name]]
          </paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

  </template>

  <script src="uqlibrary-search.js"></script>
</dom-module>
