<link rel="import" href="elements.html">

<!--
`<uqlibrary-search>` is a simple element that displays search functionality of UQ Library

Example:

  <uqlibrary-search></uqlibrary-search>

@demo

@demo demo/index.html Demo of uqlibrary-search
-->
<dom-module id="uqlibrary-search">
  <template>
    <style is="custom-style" include="common-styles">
      :host {
        font-family: var(--font-family);
        font-size: var(--body-font-size);
        position: relative;

        @apply(--layout-horizontal);
        @apply(--layout-wrap);
      }

      #inputSources,
      #buttonSearch {
        @apply(--layout-flex-1);
      }

      #inputSources,
      #searchKeywordInput {
        margin-right: 8px;
        padding-left: 8px;
        padding-right: 4px;
        background-color: var(--secondary-color-light);
        border-radius: 3px;
        min-width: 210px;
      }

      #menuSources {
        border-radius: 3px;
        @apply(--shadow-elevation-2dp);
      }

      #listSources paper-item {
        cursor: pointer;
      }

      #searchKeywordInput {
        @apply(--layout-flex);
      }

      #buttonSearch iron-icon {
        margin-top: 9px;
      }

      @media screen and (max-width: 815px) {
        :host {
          @apply(--layout-flex-none);
        }

        #inputSources{
          width: 100%;
          display: block;
          margin-bottom: 8px;
          margin-right: 0;
          min-width: 270px;
        }

        #searchKeywordInput {
          min-width: calc(100% - 105px);
        }
      }

      paper-tabs {
        width: 100%;
        text-transform: uppercase;
        font-size: 20px;
        --paper-tabs-selection-bar-color: var(--accent-color);
        margin-bottom: 20px;
        border-bottom: 1px solid lightgrey;
      }

      .betaSearchMarker paper-input-container {
        background-color: #d7e2ef;
      }

      paper-tab.iron-selected {
        color: var(--accent-color);
      }

      paper-item {
        --paper-item-focused-before: {
          background-color: white;
          opacity: 0;
        };
      }

      #newPrimoTagLine {
        display: none;
        width: 100%;
        margin-top: 10px;
        color: var(--secondary-color);
      }

      paper-item.card-actions {
        display: block;
        width: 100%;
        position: relative;
        border-top-width: 0;
        padding: 0;
      }
      .card-actions div {
        border-top: 1px solid var(--border-color);
        padding: 5px 0 16px 0;
        padding: .3125rem 0 1rem 0;
        margin-top: 16px;
        margin-top: 1rem;
        position: relative;
        text-align: right;
        font-size: 16px;
        font-size: 1rem;
      }


      @media screen and (max-width: 480px) {
        paper-tab {
          // resize the tab font size in the primo beta test
          font-size: 14px;
        }
      }

      @media screen and (max-width: 320px) {
        #inputSources {
          min-width: 100%;
        }
      }

      @media screen and (max-width: 400px) {
        .card-actions paper-button {
          @apply(--layout-vertical);
          margin: 8px 0;
        }
      }
    </style>

    <uqlibrary-ga id="ga" app-name="{{gaAppName}}"></uqlibrary-ga>

    <uqlibrary-api-search-suggestions
            id="ajax"
            on-uqlibrary-api-search-suggestions-loaded="_suggestionsLoaded"></uqlibrary-api-search-suggestions>

    <iron-localstorage id="localstorage"
                       name="uqlibrary-search-storage"
                       value="{{recent}}"
                       on-iron-localstorage-load="_localStorageLoaded"
                       on-iron-localstorage-load-empty="_localStorageLoaded"></iron-localstorage>



    <iron-a11y-keys target="[[_inputSourcesTarget]]" keys="enter" on-keys-pressed="_keywordFocused"></iron-a11y-keys>

    <paper-tabs id="betaTestSelector" selected="{{userChoice}}" on-iron-select="onTabSelect">
      <paper-tab id="oldPrimo" name="oldPrimo" aria-label="UQ Library search">
        UQ Library search
      </paper-tab>
      <paper-tab id="newPrimo" name="newPrimo" aria-label="Try the new look">
        Try the new look
      </paper-tab>
    </paper-tabs>

    <paper-item id="newPrimoTagLine">
      <div>Updated look, better filtering <a href="#">and more</a>.  Try it and tell us what you think.</div>
    </paper-item>

    <paper-item>
      <div>
        <paper-input readonly label="Search" id="inputSources" on-tap="_keywordFocused" value$="{{selectedSource.name}}"
                     role="combobox" aria-label="select search scope">
          <paper-icon-button suffix icon="unfold-more" aria-label="select search scope" role="button" alt="select search scope"
                             title="select search scope" style="margin-top: -15px;">
          </paper-icon-button>
        </paper-input>
      </div>
    </paper-item>


    <uqlibrary-iron-dropdown id="menuSources"
                             horizontal-align="left" vertical-align="top" position-absolute="true"
                             horizontal-offset="20" vertical-offset="36" tabindex="-1" aria-label="Search scopes">

      <paper-listbox id="listSources" class="dropdown-content" selected="{{selectedSourceIndex}}" >
        <template is="dom-repeat" items="[[sources]]">
          <paper-item role="option" aria-label="Search in [[item.name]]" title="Search in [[item.name]]">
            <iron-icon icon="[[item.icon]]" aria-hidden></iron-icon> [[item.name]]
          </paper-item>
        </template>
      </paper-listbox>
    </uqlibrary-iron-dropdown>

    <uqlibrary-autosuggest-input id="searchKeywordInput" label="[[selectedSource.inputPlaceholder]]" source="{{selectedSource}}" aria-label="enter search keyword"
                                 on-activated="_searchActivated" on-keyword-changed="_keywordChanged" on-focus="_closeSources"></uqlibrary-autosuggest-input>

    <paper-button id="buttonSearch" role="button" on-tap="_searchActivated" class="button-colored-accent"
                  aria-label="Search [[selectedSource.title]]" title="Search [[selectedSource.title]]">
      <iron-icon icon="icons:search" aria-label="Search [[selectedSource.title]]"></iron-icon>
    </paper-button>

    <paper-item class="card-actions">
      <div>
        <template is="dom-repeat" id="selectedSearchSource" items="[[selectedSource.helpLinks]]">
          <paper-button class="button-secondary" tabindex="-1" disabled$="[[!item.enabled]]"><a href$="[[item.url]]">[[item.title]]</a></paper-button>
        </template>
      </div>
    </paper-item>

  </template>

  <script src="uqlibrary-search.js"></script>
</dom-module>
